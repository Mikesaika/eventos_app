<div class="container mt-4">
  
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <h2 class="mb-0">Lista de Pedidos</h2>
    
    <div class="d-flex gap-2">
      <input 
        type="text" 
        class="form-control" 
        placeholder="Buscar pedidos..." 
        (keyup)="search(txtSearch)" 
        #txtSearch
        style="min-width: 250px;"
      >
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="row mb-4" *ngIf="!loading">
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card text-center border-primary">
        <div class="card-body">
          <h5 class="card-title text-primary">{{ orders.length }}</h5>
          <p class="card-text">Total Pedidos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card text-center border-success">
        <div class="card-body">
          <h5 class="card-title text-success">{{ getActiveOrdersCount() }}</h5>
          <p class="card-text">Pedidos Activos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card text-center border-danger">
        <div class="card-body">
          <h5 class="card-title text-danger">{{ getInactiveOrdersCount() }}</h5>
          <p class="card-text">Pedidos Inactivos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card text-center border-info">
        <div class="card-body">
          <h5 class="card-title text-info">{{ getTotalRevenue() | currency:'USD' }}</h5>
          <p class="card-text">Ingreso Total</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3">Cargando pedidos...</p>
  </div>

  <!-- Tabla de pedidos -->
  <div class="table-responsive" *ngIf="!loading">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Información del Usuario</th>
          <th>Información del Servicio</th>
          <th>Fecha del Evento</th>
          <th>Total</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of orders; let i = index">
          <td class="fw-bold">{{ i + 1 }}</td>
          
          <td>
            <div class="d-flex flex-column">
              <span class="fw-semibold">{{ getUserName(o.userId) }}</span>
              <small class="text-muted">{{ getUserEmail(o.userId) }}</small>
            </div>
          </td>
          
          <td>
            <div class="d-flex flex-column">
              <span class="fw-semibold">{{ getServiceName(o.serviceId) }}</span>
              <small class="text-muted text-truncate" style="max-width: 200px;">{{ getServiceDescription(o.serviceId) }}</small>
            </div>
          </td>
          
          <td>
            <div class="d-flex align-items-center">
              <i class="bi bi-calendar-event me-2 text-muted"></i>
              <span>{{ o.date | date:'dd/MM/yyyy' }}</span>
            </div>
          </td>
          
          <td class="fw-bold text-success">
            {{ o.total | currency:'USD' }}
          </td>

          <td>
            <span class="badge rounded-pill" [ngClass]="o.active ? 'bg-success' : 'bg-danger'">
              <i class="bi me-1" [ngClass]="o.active ? 'bi-check-circle' : 'bi-x-circle'"></i>
              {{ o.active ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
        </tr>

        <tr *ngIf="orders.length === 0">
          <td colspan="6" class="text-center py-4 text-muted">
            <i class="bi bi-inbox me-2" style="font-size: 2rem;"></i>
            <div>No se encontraron pedidos</div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pie con resumen -->
  <div class="alert alert-light mt-4" *ngIf="!loading && orders.length > 0">
    <div class="row">
      <div class="col-md-6">
        <h6><i class="bi bi-info-circle me-2"></i>Resumen de Pedidos</h6>
        <p class="mb-0">
          Mostrando {{ orders.length }} pedido(s) en total. 
          {{ getActiveOrdersCount() }} activo(s) y {{ getInactiveOrdersCount() }} inactivo(s).
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <h6><i class="bi bi-currency-dollar me-2"></i>Ingresos Generados</h6>
        <p class="mb-0 fw-bold text-success fs-5">
          {{ getTotalRevenue() | currency:'USD' }}
        </p>
      </div>
    </div>
  </div>
</div>
